<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Chef::Dirsrv - RDoc Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>libraries/dirsrv.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-add_entry">#add_entry</a>
    
    <li><a href="#method-i-bind">#bind</a>
    
    <li><a href="#method-i-delete_entry">#delete_entry</a>
    
    <li><a href="#method-i-get_entry">#get_entry</a>
    
    <li><a href="#method-i-modify_entry">#modify_entry</a>
    
    <li><a href="#method-i-search">#search</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../Chef.html">Chef</a>
  
    <li><a href="../Chef/Dirsrv.html">Chef::Dirsrv</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Chef::Dirsrv</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-ldap" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">ldap</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <h2 id="attribute-i-ldap-label-About">About</h2>

<p>Configuration of the directory server is almost entirely via ldap objects.
This class enables LDAP connectivity to the directory server via the
net-ldap library.</p>

<p>To make use of most methods in this library, you will need to pass in a
resource object for the connection that has the following methods:</p>
<dl class="rdoc-list note-list"><dt>host
<dd>
<p>the ldap host to connect to.</p>
</dd><dt>port
<dd>
<p>the ldap port to connect to</p>
</dd><dt>credentials
<dd>
<p>either a hash with the userdn and password to use, or a string that
identifies the name of a databag item. see the documentation in the
README.md for details.</p>
</dd></dl>

<p>The main user of this library is the dirsrv_entry resource, which has
sensible defaults for these three items.</p>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-c-new-label-Constraints">Constraints</h2>

<p><a href="../Chef.html">Chef</a> libraries are evaluated before the recipe
that places the chef_gem that it needs is put into place. This places two
constraints on this library: 1) A 'require' must be done in a method 2)
This class cannot use 'Subclass &lt; Superclass' As Net::LDAP is a class it
cannot be included as a module</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
  <span class="ruby-comment"># </span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'rubygems'</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'net-ldap'</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">'cicphash'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_entry</span><span
            class="method-args">( r ) { |r| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-add_entry-label-Add+Entry">Add Entry</h2>

<p>This method accepts a connection resource object. It is intended to be used
with Chef::Resource::DirsrvEntry objects that will also have a .dn method
and attributes  to be set on the entry to be created.</p>
          

          
          <div class="method-source-code" id="add_entry-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_entry</span>( <span class="ruby-identifier">r</span> ) <span class="ruby-comment"># :yields: r</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bind</span>( <span class="ruby-identifier">r</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">port</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cookbook_name</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>
  
  <span class="ruby-identifier">relativedn</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">dn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-comment"># Cast as a case insensitive, case preserving hash</span>
  <span class="ruby-identifier">attrs</span> = <span class="ruby-constant">CICPHash</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">attributes</span>)
  <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">seed_attributes</span>)
  <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-constant">Hash</span>[*<span class="ruby-identifier">relativedn</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'='</span>).<span class="ruby-identifier">flatten</span>])
  <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">add</span> <span class="ruby-identifier">dn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">dn</span>, <span class="ruby-identifier">attributes</span><span class="ruby-operator">:</span> <span class="ruby-identifier">attrs</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unable to add record: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Success'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_entry-source -->
          
        </div>

        

        
      </div><!-- add_entry-method -->

    
      <div id="method-i-bind" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bind</span><span
            class="method-args">( host, port, credentials, cookbook_name ) { |host, port, credentials, cookbook_name| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-bind-label-Bind">Bind</h2>

<p>This method should not be used directly. It is used to bind to the
directory server. The cookbook_name that is passed in is really the name of
the databag that it will use for looking up connection credentials. The
variable name ‘cookbook_name’ is used for clarity. It returns a connected
ruby Net::LDAP object</p>
          

          
          <div class="method-source-code" id="bind-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bind</span>( <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">cookbook_name</span> ) <span class="ruby-comment"># :yields: host, port, credentials, cookbook_name</span>

  <span class="ruby-identifier">credentials</span> = <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">to_hash</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

    <span class="ruby-comment"># Pull named credentials from the databag</span>

    <span class="ruby-identifier">require</span> <span class="ruby-string">'chef/data_bag_item'</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">'chef/encrypted_data_bag_item'</span>

    <span class="ruby-identifier">secret</span> = <span class="ruby-constant">Chef</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDataBagItem</span>.<span class="ruby-identifier">load_secret</span>
    <span class="ruby-identifier">credentials</span> = <span class="ruby-constant">Chef</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDataBagItem</span>.<span class="ruby-identifier">load</span>( <span class="ruby-identifier">cookbook_name</span>, <span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">secret</span> ).<span class="ruby-identifier">to_hash</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">'userdn'</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">'password'</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Invalid credentials: #{credentials}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@ldap</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">host</span><span class="ruby-operator">:</span> <span class="ruby-identifier">host</span>,
                        <span class="ruby-identifier">port</span><span class="ruby-operator">:</span> <span class="ruby-identifier">port</span>,
                        <span class="ruby-identifier">auth</span><span class="ruby-operator">:</span> { 
                          <span class="ruby-identifier">method</span><span class="ruby-operator">:</span>   <span class="ruby-value">:simple</span>,
                          <span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">credentials</span>[<span class="ruby-string">'userdn'</span>],
                          <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> <span class="ruby-identifier">credentials</span>[<span class="ruby-string">'password'</span>]
                        }
  
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unable to bind: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">==</span> <span class="ruby-string">'Success'</span>
  <span class="ruby-ivar">@ldap</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- bind-source -->
          
        </div>

        

        
      </div><!-- bind-method -->

    
      <div id="method-i-delete_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_entry</span><span
            class="method-args">( r ) { |r| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-delete_entry-label-Delete+Entry">Delete Entry</h2>

<p>Expects a connection resource object, along with a .dn method that returns
the Distinguished Name of the entry to be deleted.</p>
          

          
          <div class="method-source-code" id="delete_entry-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_entry</span>( <span class="ruby-identifier">r</span> ) <span class="ruby-comment"># :yields: r</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bind</span>( <span class="ruby-identifier">r</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">port</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cookbook_name</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>
  <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">dn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">dn</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unable to remove record: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r(Success|No Such Object)/</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_entry-source -->
          
        </div>

        

        
      </div><!-- delete_entry-method -->

    
      <div id="method-i-get_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_entry</span><span
            class="method-args">( r ) { |r| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-get_entry-label-Get+Entry">Get Entry</h2>

<p>This method accepts a connection resource object. It is intended to be used
with Chef::Resource::DirsrvEntry objects that will also have a .dn method
indicating Distinguished Name to be retrieved. It returns a single entry.</p>
          

          
          <div class="method-source-code" id="get_entry-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_entry</span>( <span class="ruby-identifier">r</span> ) <span class="ruby-comment"># :yields: r</span>
 
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bind</span>( <span class="ruby-identifier">r</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">port</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cookbook_name</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>
  
  <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">search</span>( 
            <span class="ruby-identifier">base</span><span class="ruby-operator">:</span>   <span class="ruby-identifier">r</span>.<span class="ruby-identifier">dn</span>, 
            <span class="ruby-identifier">filter</span><span class="ruby-operator">:</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">Filter</span>.<span class="ruby-identifier">eq</span>( <span class="ruby-string">'objectClass'</span>, <span class="ruby-string">'*'</span> ),
            <span class="ruby-identifier">scope</span><span class="ruby-operator">:</span>  <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchScope_BaseObject</span>,
            <span class="ruby-identifier">attributes</span><span class="ruby-operator">:</span> [ <span class="ruby-string">'*'</span> ]
          )
  
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error while searching: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r(Success|No Such Object)/</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">entry</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_entry-source -->
          
        </div>

        

        
      </div><!-- get_entry-method -->

    
      <div id="method-i-modify_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">modify_entry</span><span
            class="method-args">( r, ops ) { |r, ops| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-modify_entry-label-Modify+Entry">Modify Entry</h2>

<p>Accepts a connection resource object as the first argument, followed by an
Array of ldap operations. It is intended to be used with
Chef::Resource::DirsrvEntry  objects that will also have a .dn method that
returns the DN of the entry to be modified.</p>

<p>Each ldap operation in the ldap operations list is an Array object with the
following items:</p>
<ol><li>
<p>LDAP operation ( e.g. :add, :delete, :replace )</p>
</li><li>
<p>Attribute name ( String or Symbol )</p>
</li><li>
<p>Attribute Values ( String or Symbol, or Array of Strings or Symbols )</p>
</li></ol>

<p>So an example of an operations list to be passed to this method might look
like this:</p>
<dl class="rdoc-list label-list"><dt> [ :add, ‘attr1’, ‘value1’ ], [ :replace, :attr2, [ :attr2a, ‘attr2b’, :attr2c 
<dd>
<p>], [ :delete, ‘attr3’ ], [ :delete, :attr4, ‘value4’ ] ]</p>
</dd></dl>

<p>Note that none of the values passed can be Integers. They must be STRINGS
ONLY! This is a limitation of the ruby net-ldap library.</p>
          

          
          <div class="method-source-code" id="modify_entry-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">modify_entry</span>( <span class="ruby-identifier">r</span>, <span class="ruby-identifier">ops</span> ) <span class="ruby-comment"># :yields: r, ops</span>
  
  <span class="ruby-identifier">entry</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_entry</span>( <span class="ruby-identifier">r</span> )

  <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">modify</span> <span class="ruby-identifier">dn</span><span class="ruby-operator">:</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">dn</span>, <span class="ruby-identifier">operations</span><span class="ruby-operator">:</span> <span class="ruby-identifier">ops</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unable to modify record: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r(Success|Attribute or Value Exists)/</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- modify_entry-source -->
          
        </div>

        

        
      </div><!-- modify_entry-method -->

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">( r, basedn, *constraints ) { |r, basedn, filter, scope| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <h2 id="method-i-search-label-Search">Search</h2>

<p>This method is used to search the directory server. It accepts the
connection resource object described above along with the basedn to be
searched. Optionally it also accepts an LDAP filter and scope.  The default
filter is objectClass=* and the default scope is ‘base’ It returns a list
of entries.</p>
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File libraries/dirsrv.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>( <span class="ruby-identifier">r</span>, <span class="ruby-identifier">basedn</span>, *<span class="ruby-identifier">constraints</span> ) <span class="ruby-comment"># :yields: r, basedn, filter, scope</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">bind</span>( <span class="ruby-identifier">r</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">port</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">credentials</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">cookbook_name</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Must specify base dn for search&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">basedn</span>

  ( <span class="ruby-identifier">filter</span>, <span class="ruby-identifier">scope</span> ) = <span class="ruby-identifier">constraints</span>
  <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">Filter</span>.<span class="ruby-identifier">eq</span>( <span class="ruby-string">'objectClass'</span>, <span class="ruby-string">'*'</span> ) <span class="ruby-operator">:</span> <span class="ruby-identifier">filter</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">scope</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'base'</span>
    <span class="ruby-identifier">scope</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchScope_BaseObject</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">'one'</span>
    <span class="ruby-identifier">scope</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchScope_SingleLevel</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">scope</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchScope_WholeSubtree</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">LDAP</span><span class="ruby-operator">::</span><span class="ruby-constant">SearchScope_BaseObject</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">scope</span>

  <span class="ruby-identifier">entries</span> = <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">search</span>( 
              <span class="ruby-identifier">base</span><span class="ruby-operator">:</span>   <span class="ruby-identifier">basedn</span>, 
              <span class="ruby-identifier">filter</span><span class="ruby-operator">:</span> <span class="ruby-identifier">filter</span>,
              <span class="ruby-identifier">scope</span><span class="ruby-operator">:</span>  <span class="ruby-identifier">scope</span>,
              <span class="ruby-identifier">attributes</span><span class="ruby-operator">:</span> [ <span class="ruby-string">'*'</span> ]
            )

  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Error while searching: #{@ldap.get_operation_result.message}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@ldap</span>.<span class="ruby-identifier">get_operation_result</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r(Success|No Such Object)/</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">entries</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search-source -->
          
        </div>

        

        
      </div><!-- search-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

